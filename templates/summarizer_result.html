{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block header %}{{ page_header }}{% endblock %}

{% block content %}

<!-- Embed the YouTube video -->
<div class="embed-container" style="text-align:center;">
    <iframe id="youtube-video" width="560" height="315" 
            src="https://www.youtube.com/embed/{{ video_id }}?start=0" 
            title="YouTube video player" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            referrerpolicy="strict-origin-when-cross-origin" 
            allowfullscreen>
    </iframe>
</div>

<!-- JavaScript to handle jumping to the correct timestamp in the embedded video -->
<script src="https://www.youtube.com/iframe_api"></script>
<script>
    var player;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-video', {
            events: {
                'onReady': onPlayerReady,
                'onError': onPlayerError
            }
        });
    }

    function onPlayerError(event) {
    const errorDiv = document.getElementById('error-message');

    // Display a custom error message and update links
    if (event.data === 150 || event.data === 101) {
        errorDiv.innerText = "This video is unavailable for embedding. The links will now open in a new tab to watch on YouTube.";
    } else {
        errorDiv.innerText = "An error occurred while trying to play this video. The links will now open in a new tab to watch on YouTube.";
    }

    errorDiv.style.display = 'block'; // Show the error message

    // Update all summary links to open in a new tab instead of updating the embedded video
    const links = document.querySelectorAll('.summary-link');
    links.forEach(function(link) {
        link.setAttribute('target', '_blank'); // Open in a new tab
        link.setAttribute('href', link.dataset.originalHref); // Reset href to the original YouTube link
        link.setAttribute('onclick', ''); // Disable the existing onclick event
    });
}

    function onPlayerReady(event) {
        // Player is ready, additional setup can be done here if needed
 
        
    }

    function jumpToTimestamp(seconds) {
        player.seekTo(seconds, true);
        player.playVideo();
    }
</script>
<h3> Here are minute by minute Summaries! </h3>
<p> <br>The format is *minute*::*summary*<br> Click the number next to each summary to jump to that minute of the video.</p>

<div class="card">
    <div class="card-body">
        {% for summary in summaries %}
            <p>{{ summary|safe }}</p>
        {% endfor %}
    </div>
</div>

<a href="/YoutubeSummarizer" class="btn btn-secondary mt-4">{{ back_button_text }}</a>

<p><br></p>
<p class="text-muted" align="center"><small>
    The content generated by this application is for informational purposes only and is provided "as-is" without any warranties, express or implied. By using this application, you acknowledge that the developers and contributors are not liable for any claims, damages, or other liabilities arising from the use of the generated content.
</small></p>

{% endblock %}
